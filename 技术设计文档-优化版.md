# SmallDY çŸ­è§†é¢‘åº”ç”¨æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼ˆä¼˜åŒ–ç‰ˆï¼‰

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£åŸºäºåŸæŠ€æœ¯è®¾è®¡æ–‡æ¡£è¿›è¡Œä¼˜åŒ–ï¼Œä¿®å¤äº†ç‰ˆæœ¬é”™è¯¯ã€è¿‡æ—¶APIã€æ¶æ„é—®é¢˜ç­‰ï¼Œç¡®ä¿ä¸å½“å‰é¡¹ç›®çŠ¶æ€å’Œæœ€æ–°æŠ€æœ¯æ ˆä¿æŒä¸€è‡´ã€‚

---

## 1. é¡¹ç›®ç›®æ ‡

### 1.1 æ ¸å¿ƒç›®æ ‡
- å®ç°ä¸€ä¸ªç±»ä¼¼æŠ–éŸ³çš„çŸ­è§†é¢‘åº”ç”¨ï¼ŒåŒ…å«åŒåˆ—å¤–æµã€è§†é¢‘å†…æµã€è¯„è®ºç³»ç»Ÿå’ŒAIé—®ç­”åŠŸèƒ½
- æ•´ä½“è¿è¡Œæµç•…ï¼Œæ— å´©æºƒå¡æ­»ï¼Œç•Œé¢UIå’Œäº¤äº’é£æ ¼ç»Ÿä¸€ï¼Œæ•´ä½“å‘ˆç°æ•ˆæœç¾è§‚
- æ”¯æŒæ»‘åŠ¨1~2å±ä»æœ‰å…ƒç´ å±•ç¤ºï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

### 1.2 åŠŸèƒ½ç›®æ ‡
- **åŒåˆ—å¤–æµ**ï¼šå®ç°ç€‘å¸ƒæµå¸ƒå±€ï¼Œå±•ç¤ºè§†é¢‘å°é¢ã€æ ‡é¢˜ã€ä½œè€…ä¿¡æ¯ã€ç‚¹èµæ•°ç­‰
- **è§†é¢‘å†…æµ**ï¼šå…¨å±è§†é¢‘æ’­æ”¾ï¼Œæ”¯æŒä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢ã€æ’­æ”¾æ§åˆ¶ã€äº’åŠ¨åŠŸèƒ½
- **è¯„è®ºç³»ç»Ÿ**ï¼šæ”¯æŒæŸ¥çœ‹å’Œå‘å¸ƒè¯„è®ºï¼Œå®æ—¶æ›´æ–°è¯„è®ºåˆ—è¡¨
- **AIé—®ç­”**ï¼šæä¾›æ‚¬æµ®çƒå…¥å£ï¼Œæ”¯æŒä¸AIè¿›è¡Œå¯¹è¯äº¤äº’

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 æ¶æ„æ¨¡å¼
**é€‰æ‹©ï¼šMVVMï¼ˆModel-View-ViewModelï¼‰**

**åŸå› ï¼š**
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼šViewè´Ÿè´£UIå±•ç¤ºï¼ŒViewModelå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ŒModelç®¡ç†æ•°æ®
- æ•°æ®é©±åŠ¨UIï¼šé€šè¿‡StateFlowå®ç°å“åº”å¼ç¼–ç¨‹
- æ˜“äºæµ‹è¯•ï¼šViewModelå¯ç‹¬ç«‹æµ‹è¯•ï¼Œä¸ä¾èµ–UI
- ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ï¼šä¸Androidç”Ÿå‘½å‘¨æœŸè‰¯å¥½é›†æˆ
- ç¬¦åˆJetpack Composeçš„æœ€ä½³å®è·µ

### 2.2 æ ¸å¿ƒæŠ€æœ¯æ ˆï¼ˆå·²ä¿®æ­£ç‰ˆæœ¬ï¼‰

| æŠ€æœ¯ | ç‰ˆæœ¬/è¯´æ˜ | ç”¨é€” | çŠ¶æ€ |
|------|----------|------|------|
| **Kotlin** | 2.0.21 | ä¸»è¦å¼€å‘è¯­è¨€ | âœ… å·²é…ç½® |
| **Jetpack Compose BOM** | 2024.09.00 | UIæ¡†æ¶ç‰ˆæœ¬ç®¡ç† | âœ… å·²é…ç½® |
| **Navigation Compose** | 2.9.6 | é¡µé¢å¯¼èˆª | âœ… å·²é…ç½® |
| **ExoPlayer** | 2.19.1+ | è§†é¢‘æ’­æ”¾å¼•æ“ | âš ï¸ éœ€æ·»åŠ  |
| **Coil** | 2.6.0 | å›¾ç‰‡åŠ è½½åº“ | âœ… å·²é…ç½® |
| **ViewModel** | lifecycle-viewmodel-compose:2.9.4 | çŠ¶æ€ç®¡ç† | âš ï¸ éœ€æ·»åŠ  |
| **StateFlow/Flow** | kotlinx-coroutines | æ•°æ®æµ | âœ… å·²åŒ…å« |
| **Retrofit** | 2.9.0+ | ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚éœ€è¦ï¼‰ | âš ï¸ å¯é€‰ |
| **Room** | 2.6.1+ | æœ¬åœ°æ•°æ®åº“ï¼ˆå¦‚éœ€è¦ï¼‰ | âš ï¸ å¯é€‰ |

### 2.3 é‡è¦å˜æ›´è¯´æ˜

#### âš ï¸ Accompanist åº“çŠ¶æ€æ›´æ–°
**é‡è¦ï¼š** Accompanist çš„è®¸å¤šåŠŸèƒ½å·²è¢« Compose å®˜æ–¹åº“å¸æ”¶ï¼Œä¸å†éœ€è¦å•ç‹¬ä¾èµ–ï¼š

1. **accompanist-pager** â†’ **androidx.compose.foundation:foundation**
   - `HorizontalPager` å’Œ `VerticalPager` ç°åœ¨åœ¨ Compose Foundation ä¸­
   - æ— éœ€é¢å¤–ä¾èµ–

2. **accompanist-swiperefresh** â†’ **androidx.compose.material3:material3**
   - `SwipeRefresh` ç°åœ¨åœ¨ Material3 ä¸­
   - æ— éœ€é¢å¤–ä¾èµ–

3. **accompanist-navigation-animation** â†’ **Navigation Compose å†…ç½®**
   - Navigation Compose 2.7.0+ å·²å†…ç½®è½¬åœºåŠ¨ç”»æ”¯æŒ
   - ä½¿ç”¨ `composeOptions` é…ç½®åŠ¨ç”»

4. **accompanist-permissions** â†’ **ä»å¯ä½¿ç”¨æˆ–ä½¿ç”¨å®˜æ–¹ API**
   - å¯ä»¥ä½¿ç”¨ Accompanist 0.32.0+ï¼ˆå¦‚æœä»éœ€è¦ï¼‰
   - æˆ–ä½¿ç”¨ `ActivityResultContracts.RequestPermission()`

5. **accompanist-systemuicontroller** â†’ **ä»å¯ä½¿ç”¨**
   - å¦‚æœä»éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬

#### SharedElement è½¬åœºåŠ¨ç”»
- Compose 1.5.0+ å¼•å…¥äº† `SharedTransitionLayout` å’Œ `Modifier.sharedElement()`
- éœ€è¦ç¡®ä¿ Compose BOM ç‰ˆæœ¬æ”¯æŒï¼ˆ2024.09.00 å·²æ”¯æŒï¼‰

#### ViewModel ä¾èµ–æ³¨å…¥
- **æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰**ï¼šä½¿ç”¨ `viewModel()` å‡½æ•°ï¼ˆæ— éœ€ Hiltï¼‰
- **æ–¹æ¡ˆäºŒ**ï¼šä½¿ç”¨ Hilt + `hiltViewModel()`ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰

---

## 3. æ¶æ„è®¾è®¡

### 3.1 MVVMæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UI Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚FeedScreenâ”‚  â”‚VideoScreenâ”‚ â”‚CommentScreenâ”‚ â”‚ChatScreenâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚              â”‚              â”‚
        â–¼             â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ViewModel Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚FeedViewModelâ”‚ â”‚VideoViewModelâ”‚ â”‚CommentViewModelâ”‚ â”‚ChatViewModelâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚              â”‚              â”‚
        â–¼             â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Repository Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚VideoRepositoryâ”‚ â”‚UserRepositoryâ”‚ â”‚CommentRepositoryâ”‚ â”‚AIRepositoryâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚              â”‚              â”‚
        â–¼             â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Data Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚RemoteDataSourceâ”‚ â”‚LocalDataSourceâ”‚ â”‚CacheManagerâ”‚ â”‚AIServiceâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åŒ…ç»“æ„è®¾è®¡

```
com.example.smalldy/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ model/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ VideoData.kt
â”‚   â”‚   â”œâ”€â”€ UserData.kt
â”‚   â”‚   â”œâ”€â”€ CommentData.kt
â”‚   â”‚   â””â”€â”€ ChatMessage.kt
â”‚   â”œâ”€â”€ repository/         # æ•°æ®ä»“åº“
â”‚   â”‚   â”œâ”€â”€ VideoRepository.kt
â”‚   â”‚   â”œâ”€â”€ UserRepository.kt
â”‚   â”‚   â””â”€â”€ CommentRepository.kt
â”‚   â””â”€â”€ local/              # æœ¬åœ°æ•°æ®æº
â”‚       â””â”€â”€ MockDataSource.kt
â”œâ”€â”€ domain/                 # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ usecase/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ feed/               # åŒåˆ—å¤–æµ
â”‚   â”‚   â”œâ”€â”€ FeedScreen.kt
â”‚   â”‚   â”œâ”€â”€ FeedViewModel.kt
â”‚   â”‚   â””â”€â”€ FeedCard.kt
â”‚   â”œâ”€â”€ video/              # è§†é¢‘å†…æµ
â”‚   â”‚   â”œâ”€â”€ VideoScreen.kt
â”‚   â”‚   â”œâ”€â”€ VideoViewModel.kt
â”‚   â”‚   â”œâ”€â”€ VideoPlayer.kt
â”‚   â”‚   â””â”€â”€ VideoControls.kt
â”‚   â”œâ”€â”€ comment/            # è¯„è®ºé¡µé¢
â”‚   â”‚   â”œâ”€â”€ CommentScreen.kt
â”‚   â”‚   â”œâ”€â”€ CommentViewModel.kt
â”‚   â”‚   â””â”€â”€ CommentItem.kt
â”‚   â”œâ”€â”€ chat/               # AIé—®ç­”
â”‚   â”‚   â”œâ”€â”€ ChatScreen.kt
â”‚   â”‚   â”œâ”€â”€ ChatViewModel.kt
â”‚   â”‚   â””â”€â”€ FloatingBall.kt
â”‚   â””â”€â”€ common/             # å…¬å…±ç»„ä»¶
â”‚       â”œâ”€â”€ TopNav.kt
â”‚       â”œâ”€â”€ BottomNav.kt
â”‚       â””â”€â”€ RefreshIndicator.kt
â””â”€â”€ util/                   # å·¥å…·ç±»
    â”œâ”€â”€ ImagePicker.kt
    â””â”€â”€ VideoUtils.kt
```

---

## 4. ä¾èµ–é…ç½®ä¿®æ­£

### 4.1 éœ€è¦æ·»åŠ çš„ä¾èµ–

åœ¨ `app/build.gradle.kts` ä¸­æ·»åŠ ï¼š

```kotlin
dependencies {
    // ... ç°æœ‰ä¾èµ– ...
    
    // ViewModel (å¿…éœ€)
    implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.9.4")
    
    // ExoPlayer (è§†é¢‘æ’­æ”¾)
    implementation("androidx.media3:media3-exoplayer:1.4.1")
    implementation("androidx.media3:media3-ui:1.4.1")
    implementation("androidx.media3:media3-common:1.4.1")
    
    // Compose Foundation (åŒ…å« Pager)
    implementation("androidx.compose.foundation:foundation")
    
    // Coroutines (å¦‚æœè¿˜æ²¡æœ‰)
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.8.1")
    
    // å¯é€‰ï¼šHilt (å¦‚æœéœ€è¦ä¾èµ–æ³¨å…¥)
    // implementation("com.google.dagger:hilt-android:2.52")
    // kapt("com.google.dagger:hilt-compiler:2.52")
    // implementation("androidx.hilt:hilt-navigation-compose:1.2.0")
}
```

### 4.2 ç‰ˆæœ¬ç»Ÿä¸€

**ä¿®æ­£åçš„ç‰ˆæœ¬é…ç½®ï¼š**

```kotlin
// gradle/libs.versions.toml
[versions]
composeBom = "2024.09.00"  // âœ… æ­£ç¡®ç‰ˆæœ¬ï¼ˆä¸æ˜¯ 2025.08.00ï¼‰
navigationCompose = "2.9.6"  // âœ… ç»Ÿä¸€ç‰ˆæœ¬
lifecycleRuntimeKtx = "2.9.4"
```

---

## 5. åŠŸèƒ½å®ç°æ€è·¯å’Œéš¾ç‚¹ï¼ˆä¿®æ­£ç‰ˆï¼‰

### 5.1 åŒåˆ—å¤–æµï¼ˆFeedæµï¼‰

#### 5.1.1 UIå¸ƒå±€å®ç°

**æŠ€æœ¯æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ `LazyVerticalGrid` å®ç°åŒåˆ—å¸ƒå±€
- æ¯ä¸ªå¡ç‰‡åŒ…å«ï¼šå°é¢å›¾ã€æ ‡é¢˜ã€ä½œè€…ä¿¡æ¯ã€ç‚¹èµæ•°

**å®ç°ä»£ç ç»“æ„ï¼ˆä¿®æ­£ç‰ˆï¼‰ï¼š**
```kotlin
@Composable
fun FeedScreen(
    viewModel: FeedViewModel = viewModel() // âœ… ä½¿ç”¨ viewModel() è€Œä¸æ˜¯ hiltViewModel()
) {
    val videos by viewModel.videos.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    
    LazyVerticalGrid(
        columns = GridCells.Fixed(2),
        contentPadding = PaddingValues(8.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(videos) { video ->
            FeedCard(
                video = video,
                onClick = { viewModel.navigateToVideo(video.id) }
            )
        }
    }
}
```

#### 5.1.2 ç‚¹å‡»å°é¢è¿›å…¥è§†é¢‘å†…æµ

**è½¬åœºåŠ¨ç”»å®ç°ï¼ˆä¿®æ­£ç‰ˆï¼‰ï¼š**

Compose 1.5.0+ ä½¿ç”¨ `SharedTransitionLayout`ï¼š

```kotlin
// åœ¨å¤–æµä¸­ä½¿ç”¨
@Composable
fun FeedCard(video: VideoData, onClick: () -> Unit) {
    SharedTransitionLayout {
        AsyncImage(
            model = video.coverUrl,
            modifier = Modifier
                .sharedElement(
                    rememberSharedContentState(key = "video_${video.id}"),
                    this@SharedTransitionLayout
                )
                .clickable { onClick() }
        )
    }
}

// åœ¨è§†é¢‘å†…æµä¸­ä½¿ç”¨ç›¸åŒçš„key
@Composable
fun VideoScreen(video: VideoData) {
    SharedTransitionLayout {
        VideoPlayer(
            video = video,
            modifier = Modifier
                .sharedElement(
                    rememberSharedContentState(key = "video_${video.id}"),
                    this@SharedTransitionLayout
                )
        )
    }
}
```

#### 5.1.4 ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½ï¼ˆä¿®æ­£ç‰ˆï¼‰

**ä½¿ç”¨ Material3 çš„ SwipeRefreshï¼š**

```kotlin
@Composable
fun FeedScreen(viewModel: FeedViewModel = viewModel()) {
    val videos by viewModel.videos.collectAsState()
    val isRefreshing by viewModel.isRefreshing.collectAsState()
    val listState = rememberLazyListState()
    
    SwipeRefresh(
        state = rememberSwipeRefreshState(isRefreshing),
        onRefresh = { viewModel.refreshVideos() }
    ) {
        LazyVerticalGrid(
            state = listState,
            columns = GridCells.Fixed(2),
            // ...
        ) {
            items(videos) { video ->
                FeedCard(video = video)
            }
        }
        
        // ç›‘å¬æ»šåŠ¨åˆ°åº•éƒ¨
        LaunchedEffect(listState) {
            snapshotFlow {
                listState.layoutInfo.visibleItemsInfo.lastOrNull()?.index
            }.collect { lastIndex ->
                if (lastIndex == videos.size - 1) {
                    viewModel.loadMoreVideos()
                }
            }
        }
    }
}
```

#### 5.1.6 å·¦å³æ»‘åŠ¨åˆ‡æ¢é¡¶éƒ¨Barï¼ˆä¿®æ­£ç‰ˆï¼‰

**ä½¿ç”¨ Compose Foundation çš„ HorizontalPagerï¼š**

```kotlin
@Composable
fun TopTabScreen() {
    val tabs = listOf("å¸åŸ", "å›¢è´­", "ç›´æ’­", "å•†åŸ", "æ¨è")
    val pagerState = rememberPagerState(pageCount = { tabs.size })
    
    Column {
        TabRow(selectedTabIndex = pagerState.currentPage) {
            tabs.forEachIndexed { index, tab ->
                Tab(
                    selected = pagerState.currentPage == index,
                    onClick = { 
                        coroutineScope.launch { 
                            pagerState.animateScrollToPage(index) 
                        } 
                    }
                ) {
                    Text(tab)
                }
            }
        }
        
        HorizontalPager(
            state = pagerState,
            modifier = Modifier.fillMaxSize()
        ) { page ->
            when (page) {
                0 -> FeedScreen()
                1 -> GroupBuyScreen()
                // ...
            }
        }
    }
}
```

### 5.2 è§†é¢‘å†…æµï¼ˆVideo Streamï¼‰

#### 5.2.2 ç‚¹å‡»æš‚åœã€æ’­æ”¾ï¼ˆä¿®æ­£ç‰ˆï¼‰

**ä½¿ç”¨ Media3 ExoPlayerï¼š**

```kotlin
@Composable
fun VideoPlayer(
    video: VideoData,
    modifier: Modifier = Modifier
) {
    val context = LocalContext.current
    val player = remember {
        ExoPlayer.Builder(context).build().apply {
            setMediaItem(MediaItem.fromUri(video.videoUrl))
            prepare()
            playWhenReady = true
        }
    }
    
    DisposableEffect(Unit) {
        onDispose {
            player.release()
        }
    }
    
    val isPlaying by remember {
        derivedStateOf { player.isPlaying }
    }
    
    Box(
        modifier = modifier
            .fillMaxSize()
            .clickable { 
                if (isPlaying) player.pause() else player.play()
            }
    ) {
        AndroidView(
            factory = { ctx ->
                PlayerView(ctx).apply {
                    this.player = player
                    useController = false // éšè—é»˜è®¤æ§åˆ¶å™¨
                }
            },
            modifier = Modifier.fillMaxSize()
        )
        
        if (!isPlaying) {
            Icon(
                imageVector = Icons.Default.PlayArrow,
                contentDescription = "æ’­æ”¾",
                modifier = Modifier
                    .align(Alignment.Center)
                    .size(64.dp)
            )
        }
    }
}
```

#### 5.2.3 æ‰‹æŒ‡ä¸Šä¸‹ç§»åŠ¨ã€åˆ‡æ¢è§†é¢‘ï¼ˆä¿®æ­£ç‰ˆï¼‰

**ä½¿ç”¨ Compose Foundation çš„ VerticalPagerï¼š**

```kotlin
@Composable
fun VideoScreen(
    initialVideoId: String,
    viewModel: VideoViewModel = viewModel()
) {
    val videos by viewModel.videos.collectAsState()
    val pagerState = rememberPagerState(
        initialPage = videos.indexOfFirst { it.id == initialVideoId }
            .takeIf { it >= 0 } ?: 0,
        pageCount = { videos.size }
    )
    
    VerticalPager(
        state = pagerState,
        modifier = Modifier.fillMaxSize()
    ) { page ->
        VideoPlayerItem(
            video = videos[page],
            isActive = pagerState.currentPage == page
        )
    }
    
    // é¢„åŠ è½½é€»è¾‘
    LaunchedEffect(pagerState.currentPage) {
        val current = pagerState.currentPage
        if (current < videos.size - 1) {
            viewModel.preloadVideo(videos[current + 1].id)
        }
    }
}
```

---

## 6. æ•°æ®å±‚è®¾è®¡

### 6.1 æ•°æ®æ¨¡å‹

```kotlin
// è§†é¢‘æ•°æ®
data class VideoData(
    val id: String,
    val coverUrl: String,
    val videoUrl: String,
    val title: String,
    val description: String?,
    val author: UserData,
    val likeCount: Int,
    val commentCount: Int,
    val shareCount: Int,
    val isLiked: Boolean,
    val timestamp: Long
)

// ç”¨æˆ·æ•°æ®
data class UserData(
    val id: String,
    val name: String,
    val avatar: String,
    val bio: String?,
    val followerCount: Int
)

// è¯„è®ºæ•°æ®
data class CommentData(
    val id: String,
    val author: UserData,
    val content: String,
    val timestamp: Long,
    val likeCount: Int,
    val replies: List<CommentData> = emptyList()
)

// èŠå¤©æ¶ˆæ¯
data class ChatMessage(
    val id: String,
    val content: String,
    val type: MessageType, // USER, AI
    val timestamp: Long
)

enum class MessageType {
    USER, AI
}
```

### 6.2 ViewModel å®ç°ï¼ˆä¿®æ­£ç‰ˆï¼‰

```kotlin
class FeedViewModel : ViewModel() {
    private val repository = VideoRepository()
    
    private val _videos = MutableStateFlow<List<VideoData>>(emptyList())
    val videos: StateFlow<List<VideoData>> = _videos.asStateFlow()
    
    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()
    
    private val _isRefreshing = MutableStateFlow(false)
    val isRefreshing: StateFlow<Boolean> = _isRefreshing.asStateFlow()
    
    init {
        loadVideos()
    }
    
    fun loadVideos() {
        viewModelScope.launch {
            _isLoading.value = true
            try {
                _videos.value = repository.getVideos()
            } finally {
                _isLoading.value = false
            }
        }
    }
    
    fun refreshVideos() {
        viewModelScope.launch {
            _isRefreshing.value = true
            try {
                _videos.value = repository.refreshVideos()
            } finally {
                _isRefreshing.value = false
            }
        }
    }
    
    fun loadMoreVideos() {
        viewModelScope.launch {
            val moreVideos = repository.loadMoreVideos()
            _videos.value = _videos.value + moreVideos
        }
    }
}
```

---

## 7. å…³é”®æŠ€æœ¯éš¾ç‚¹æ€»ç»“ï¼ˆä¿®æ­£ç‰ˆï¼‰

### 7.1 è½¬åœºåŠ¨ç”»
- **éš¾ç‚¹**ï¼šä»å°é¢åˆ°å…¨å±è§†é¢‘çš„æ— ç¼è½¬åœº
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Compose 1.5.0+ çš„ `SharedTransitionLayout` å’Œ `Modifier.sharedElement()`
- **æ³¨æ„**ï¼šç¡®ä¿ Compose BOM ç‰ˆæœ¬ >= 2024.09.00

### 7.2 è§†é¢‘é¢„åŠ è½½
- **éš¾ç‚¹**ï¼šä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢è§†é¢‘æ—¶çš„æµç•…æ€§
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ ExoPlayer çš„é¢„åŠ è½½æœºåˆ¶ï¼Œæå‰å‡†å¤‡ç›¸é‚»è§†é¢‘
- **ä¼˜åŒ–**ï¼šä½¿ç”¨ `ExoPlayer.Builder` é…ç½®ç¼“å­˜ç­–ç•¥

### 7.3 æ‰‹åŠ¿å†²çª
- **éš¾ç‚¹**ï¼šåŒå‡»ç‚¹èµã€ä¸Šä¸‹æ»‘åŠ¨ã€å·¦å³æ»‘åŠ¨çš„å†²çªå¤„ç†
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `Modifier.pointerInput` ç²¾ç¡®æ§åˆ¶æ‰‹åŠ¿ä¼˜å…ˆçº§
- **æŠ€å·§**ï¼šä½¿ç”¨ `detectTapGestures` å’Œ `detectDragGestures` åŒºåˆ†ä¸åŒæ‰‹åŠ¿

### 7.4 æ€§èƒ½ä¼˜åŒ–
- **éš¾ç‚¹**ï¼šå¤§é‡è§†é¢‘åˆ—è¡¨çš„æµç•…æ»šåŠ¨
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ `LazyColumn`/`LazyVerticalGrid` è¿›è¡Œè™šæ‹ŸåŒ–
  - ä½¿ç”¨ Coil çš„å›¾ç‰‡ç¼“å­˜
  - è§†é¢‘é¢„åŠ è½½å’Œæ’­æ”¾å™¨å¤ç”¨
  - ä½¿ç”¨ `remember` å’Œ `derivedStateOf` å‡å°‘é‡ç»„

### 7.5 çŠ¶æ€ç®¡ç†
- **éš¾ç‚¹**ï¼šå¤šä¸ªé¡µé¢é—´çš„çŠ¶æ€åŒæ­¥
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ ViewModel + StateFlow ç®¡ç†çŠ¶æ€
  - ä½¿ç”¨ Navigation Compose ä¼ é€’å‚æ•°
  - ä½¿ç”¨ `rememberSaveable` ä¿å­˜çŠ¶æ€

---

## 8. å¼€å‘è®¡åˆ’ï¼ˆä¼˜åŒ–ç‰ˆï¼‰

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„æ­å»ºï¼ˆ1-2å¤©ï¼‰
- [x] æ­å»ºMVVMæ¶æ„
- [x] é…ç½®ä¾èµ–ï¼ˆComposeã€Navigationï¼‰
- [ ] æ·»åŠ  ExoPlayer ä¾èµ–
- [ ] æ·»åŠ  ViewModel ä¾èµ–
- [ ] å®ç°åŸºç¡€å¯¼èˆªç»“æ„
- [ ] åˆ›å»ºæ•°æ®æ¨¡å‹å’Œ Mock æ•°æ®æº

### é˜¶æ®µäºŒï¼šåŒåˆ—å¤–æµå®ç°ï¼ˆ2-3å¤©ï¼‰
- [ ] å®ç°åŒåˆ—å¸ƒå±€ï¼ˆLazyVerticalGridï¼‰
- [ ] å®ç°ä¸‹æ‹‰åˆ·æ–°ï¼ˆMaterial3 SwipeRefreshï¼‰
- [ ] å®ç°ä¸Šæ‹‰åŠ è½½
- [ ] å®ç°è½¬åœºåŠ¨ç”»ï¼ˆSharedTransitionLayoutï¼‰
- [ ] å®ç°Tabåˆ‡æ¢ï¼ˆHorizontalPagerï¼‰

### é˜¶æ®µä¸‰ï¼šè§†é¢‘å†…æµå®ç°ï¼ˆ3-4å¤©ï¼‰
- [ ] é›†æˆ ExoPlayerï¼ˆMedia3ï¼‰
- [ ] å®ç°ä¸Šä¸‹æ»‘åŠ¨åˆ‡æ¢ï¼ˆVerticalPagerï¼‰
- [ ] å®ç°æ’­æ”¾æ§åˆ¶
- [ ] å®ç°åŒå‡»ç‚¹èµåŠ¨ç”»
- [ ] å®ç°éŸ³ä¹è½¬ç›˜
- [ ] å®ç°è§†é¢‘é¢„åŠ è½½

### é˜¶æ®µå››ï¼šè¯„è®ºç³»ç»Ÿï¼ˆ1-2å¤©ï¼‰
- [ ] å®ç°è¯„è®ºåˆ—è¡¨
- [ ] å®ç°è¯„è®ºå‘å¸ƒ
- [ ] å®ç°è‡ªé€‚åº”å¸ƒå±€

### é˜¶æ®µäº”ï¼šAIé—®ç­”ï¼ˆ2-3å¤©ï¼‰
- [ ] å®ç°æ‚¬æµ®çƒï¼ˆå¯æ‹–åŠ¨ï¼‰
- [ ] å®ç°èŠå¤©ç•Œé¢
- [ ] é›†æˆAIæœåŠ¡ï¼ˆAPIæˆ–æœ¬åœ°æ¨¡å‹ï¼‰

### é˜¶æ®µå…­ï¼šä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1-2å¤©ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] UI/UXä¼˜åŒ–
- [ ] æµ‹è¯•å’ŒBugä¿®å¤

---

## 9. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### Q1: ä¸ºä»€ä¹ˆä¸å†ä½¿ç”¨ Accompanistï¼Ÿ
**A:** Accompanist çš„è®¸å¤šåŠŸèƒ½å·²è¢« Compose å®˜æ–¹åº“å¸æ”¶ã€‚ä½¿ç”¨å®˜æ–¹åº“å¯ä»¥è·å¾—æ›´å¥½çš„æ”¯æŒå’Œç»´æŠ¤ã€‚

### Q2: å¦‚ä½•é€‰æ‹© ViewModel çš„åˆ›å»ºæ–¹å¼ï¼Ÿ
**A:** 
- ç®€å•é¡¹ç›®ï¼šä½¿ç”¨ `viewModel()` å‡½æ•°
- å¤æ‚é¡¹ç›®ï¼šä½¿ç”¨ Hilt + `hiltViewModel()`

### Q3: SharedTransitionLayout ä¸å·¥ä½œï¼Ÿ
**A:** ç¡®ä¿ï¼š
1. Compose BOM >= 2024.09.00
2. ä½¿ç”¨ç›¸åŒçš„ `SharedContentState` key
3. ä¸¤ä¸ªç»„ä»¶éƒ½åœ¨ `SharedTransitionLayout` ä½œç”¨åŸŸå†…

### Q4: ExoPlayer ç‰ˆæœ¬é€‰æ‹©ï¼Ÿ
**A:** ä½¿ç”¨ Media3ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰ï¼Œè€Œä¸æ˜¯æ—§çš„ ExoPlayer 2.xã€‚Media3 æ˜¯ ExoPlayer çš„ä¸‹ä¸€ä»£ç‰ˆæœ¬ã€‚

---

## 10. å‚è€ƒèµ„æ–™

- [Jetpack Compose å®˜æ–¹æ–‡æ¡£](https://developer.android.com/jetpack/compose)
- [Compose Foundation (Pager)](https://developer.android.com/jetpack/compose/layouts/pager)
- [Media3 ExoPlayer å®˜æ–¹æ–‡æ¡£](https://developer.android.com/guide/topics/media/media3)
- [Navigation Compose](https://developer.android.com/jetpack/compose/navigation)
- [Coil å›¾ç‰‡åŠ è½½åº“](https://coil-kt.github.io/coil/)
- [ViewModel in Compose](https://developer.android.com/jetpack/compose/state#viewmodel)

---

## 11. ç‰ˆæœ¬å†å²

- **v2.0 (ä¼˜åŒ–ç‰ˆ)**ï¼šä¿®æ­£ç‰ˆæœ¬é”™è¯¯ã€æ›´æ–°è¿‡æ—¶APIã€ä¼˜åŒ–æ¶æ„è®¾è®¡
- **v1.0 (åŸç‰ˆ)**ï¼šåˆå§‹æŠ€æœ¯è®¾è®¡æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0ï¼ˆä¼˜åŒ–ç‰ˆï¼‰  
**æœ€åæ›´æ–°**ï¼š2024å¹´12æœˆ  
**ä¼˜åŒ–è¯´æ˜**ï¼šä¿®æ­£ç‰ˆæœ¬å·ã€æ›´æ–°APIä½¿ç”¨ã€ä¼˜åŒ–æ¶æ„å»ºè®®

